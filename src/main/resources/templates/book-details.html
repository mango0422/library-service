<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>책 정보</title>

    <link
      type="text/css"
      rel="stylesheet"
      href="../static/css/book_details.css"
      th:href="@{/css/book_details.css}"
    />
    <script
      type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    ></script>
    <!-- HTML 내부에 스크립트 추가 -->
    <script>
      // 서버로부터 응답을 받는 함수
      function handleResponse(response) {
        var responseData = response.split("|"); // 응답을 "|" 기준으로 분리하여 배열로 저장
        var statusCode = responseData[0];
        var message = responseData[1];

        // 팝업창 띄우기
        alert(message);

        // 상황에 따라 페이지 이동
        if (statusCode === "1") {
          // 로그인이 필요한 경우 로그인 페이지로 이동
          location.href = "/login";
        } else if (statusCode === "2") {
          // 대출 권수 초과한 경우 다른 페이지로 이동
          location.href = "/other-page";
        } else if (statusCode === "3") {
          // 대출이 완료된 경우 다른 페이지로 이동
          location.href = "/another-page";
        }
      }

      // 버튼 클릭 이벤트 핸들러
      function handleClick() {
        var id = 1; // id 값을 적절하게 설정
        // GET 요청 보내기
        fetch("/borrow/" + id)
          .then(function (response) {
            return response.text(); // 응답 데이터를 텍스트 형식으로 반환
          })
          .then(function (responseData) {
            handleResponse(responseData); // 응답 처리 함수 호출
          })
          .catch(function (error) {
            console.error("Error:", error);
          });
      }
    </script>
  </head>

  <body>
    <div class="header">
      <div class="tab-box">
        <a href="/home"
          ><img
            id="gachonlogo"
            src="../static/img/gachonlogo.jpg"
            th:src="@{/img/gachonlogo.jpg}"
        /></a>

        <ul id="tab">
          <li><a th:href="@{/introduce}">도서관 소개</a></li>
          <li><a th:href="@{/search-page}">검색</a></li>
          <li><a th:href="@{/mypage}">마이페이지</a></li>
          <li><a th:href="@{/community}">커뮤니티</a></li>
        </ul>
      </div>
    </div>
    <div class="bannerbackground">
      <div class="banner">
        <h1>책 정보</h1>
      </div>
    </div>

    <!-- <div th:if="${book.isEmpty()}">
        <p>No results found.</p>
    </div> -->

    <div class="divProfileTitle">
      <div class="booktitle">
        <h2>책제목 :</h2>
        <h2 th:text="${book.book_title}"></h2>
      </div>
    </div>

    <div class="bookInfoTable">
      <div id="divProfile">
        <table
          cellspacing="0"
          summary="이 표는 서지상세정보를 나타내고 있습니다."
          class="profiletable"
        >
          <tbody>
            <tr>
              <th scope="row">도서번호</th>
              <td th:text="${book.book_code}"></td>
            </tr>
            <tr>
              <th scope="row">서명</th>
              <td th:text="${book.book_title}"></td>
            </tr>
            <tr>
              <th scope="row">저자</th>
              <td th:text="${book.book_author}"></td>
            </tr>
            <tr>
              <th scope="row">출판사</th>
              <td th:text="${book.book_publisher}"></td>
            </tr>
            <tr>
              <th scope="row">언어</th>
              <td th:text="${book.book_lang}"></td>
            </tr>
            <tr>
              <th scope="row">자료유형</th>
              <td th:text="${book.book_type}"></td>
            </tr>
            <tr>
              <th scope="row">발행년도</th>
              <td th:text="${book.book_year}"></td>
            </tr>
            <script th:inline="javascript">
              /*<![CDATA[*/
              function checkLoaned() {
                var loan = [[${book.book_borrow}]];
                if (loan == 0) {
                  var loantext = document.getElementById("loanState");
                  loantext.textContent = "대출 가능";
                } else {
                  var loantext = document.getElementById("loanState");
                  loantext.textContent = "대출중";
                }
              }
              checkLoaned();
              /*]]>*/
            </script>
            <tr>
              <th scope="row">대출현황</th>
              <td
                id="loanState"
                th:text="${showButton == 1 ? '대출 가능' : '대출중'}"
              ></td>
            </tr>
          </tbody>
        </table>
        <form action="/borrow" method="post">
          <input type="hidden" name="book_code" th:value="${book.book_code}" />
          <button th:if="${showButton == 1}" type="submit">버튼</button>
        </form>
        <div id="addtionalContent"></div>
        <div id="divHoldingInfo">
          <div class="holdingHeader"></div>
          <script type="text/javascript" src="/js/search/mylibrary.js"></script>
          <script type="text/javascript">
            var MSG_VALID_LOGIN = "로그인 후 이용하세요.";
            var MSG_VALID_SEND_SMS = "발송하시겠습니까?";
            var MSG_VALID_COMPLETE_SMS = "발송되었습니다.";
          </script>
          <script type="text/javascript">
            function goLocation(sub_loca, call_no) {
              //var url = "http://www.conbiz.co.kr/gc3/container.html#"+sub_loca+"_"+call_no;
              var url =
                "/image/ko/location/container.html#" + sub_loca + "_" + call_no;
              OpenWin = window.open(
                url,
                "open",
                "left=100,top=100,height=760,width=820,location=1,menubar=0,resizable=0,scrollbars=0,status=0,titlebar=0,toolbar=0"
              );
              if (OpenWin != null) {
                OpenWin.opener = self;
              }
            }
          </script>
        </div>
      </div>
    </div>
  </body>
</html>
